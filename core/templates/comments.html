{% extends 'base.html' %}

{% block content %}

    <h1 class="font-medium leading-tight text-5xl mt-0 mb-2 text-blue-600">
        Comments
    </h1>

    {% if user.is_staff%}
    <button type="button" 
            class="inline-block rounded bg-red-600 px-6 py-2.5 text-white font-medium uppercase leading-normal"
            hx-get="{%url 'check_spam'%}"
            hx-target="#comments"
            hx-swap="outerHTML">
            Detect Spam
    </button>
    {%endif%}
    <br>

    <div id="comments">
        {% for comment in comments %}
        <div class="flex flex-col m-3">
            <div class="block p-6 rounded-lg shadow-lg bg-white max-w-(75%)">
                <p class="text-gray-800 text-base mb-4">
                    {{ comment.text }}
                </p>

                {% if user.is_staff%}
                    <button type="button" 
                            class="inline-block rounded bg-primary px-6 pb-2 pt-2.5 text-xs font-medium uppercase leading-normal text-black shadow-[0_4px_9px_-4px_#3b71ca] transition duration-150 ease-in-out hover:bg-primary-600 hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:bg-primary-600 focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] focus:outline-none focus:ring-0 active:bg-primary-700 active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.3),0_4px_18px_0_rgba(59,113,202,0.2)] dark:shadow-[0_4px_9px_-4px_rgba(59,113,202,0.5)] dark:hover:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:focus:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)] dark:active:shadow-[0_8px_9px_-4px_rgba(59,113,202,0.2),0_4px_18px_0_rgba(59,113,202,0.1)]" 
                            hx-delete="{% url 'delete-comment' comment.pk %}">
                        Remove Post
                    </button>
                    <br>
                {%endif%}

            </div>
        </div>

        {% endfor %}
    </div>

    <script>
        htmx.on('htmx:afterRequest', function(e){
            console.log(e)
            if (e.detail.requestConfig.verb === 'delete'){
                const src = e.detail.elt
                const card = htmx.closest(src,'div[class="flex flex-col m-3' )
                htmx.remove(card)
            }
        })
    </script>

{% endblock content %}
